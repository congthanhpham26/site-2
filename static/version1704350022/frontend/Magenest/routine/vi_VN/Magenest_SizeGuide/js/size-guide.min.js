define(['jquery', 'Magento_Ui/js/modal/modal', 'mage/url', 'Magento_Swatches/js/swatch-renderer'], function($, modal, urlBuilder) {
    $.widget('magenest.sizeGuide', {
        openSizeGuide: '.open-popup-size-guide',
        chooseSizeBtn: '#size-guide-content-header-choose-size',
        tableSizeBtn: '#size-guide-content-header-table-size',
        rangeInput: '#height, #weight',
        sizeSuggestionBtn: '#size-suggestion-btn',
        sizeSuggestionForm: '#size-suggestion-form',
        sizeSuggestionResult: '#size-suggestion-result',
        sizeGuidePopup: '#popup-modal',
        backSizeGuide: '.size-suggestion-result-header-back',
        wear: '[name=wear]',
        sizeButton: '.size-suggestion-button button',
        options: {},
        _create: function() {
            $(this.openSizeGuide).on('click', this.showSizeGuidePopup.bind(this));
            $(this.chooseSizeBtn).on('click', this.openChooseSizeTab);
            $(this.tableSizeBtn).on('click', this.openTableSizeTab);
            $(this.rangeInput).on('change', this.changeSpecs);
            $(document).ready(this.loadSpecs);
            $(this.sizeSuggestionBtn).on('click', this._submit.bind(this));
            $('body').on('click', this.backSizeGuide, this._back.bind(this));
            $('body').on('click', this.sizeButton, this.chooseSize);
            $(this.wear).on('click', this.checkbox);
        },
        showSizeGuidePopup: function() {
            var options = {
                    type: 'popup',
                    responsive: false,
                    innerScroll: false,
                    buttons: [],
                    modalClass: 'modal-size-guide',
                },
                modalPopup = $(this.sizeGuidePopup);
            modal(options, modalPopup);
            modalPopup.modal('openModal');
        },
        openChooseSizeTab: function() {
            $('.size-guide-tab').css('display', 'none');
            $('.size-guide-header').removeClass('active');
            $('#size-guide-container-choose-size').css('display', 'block');
            $(this).addClass('active');
        },
        openTableSizeTab: function() {
            $('.size-guide-tab').css('display', 'none');
            $('.size-guide-header').removeClass('active');
            $('#size-guide-container-table-size').css('display', 'block');
            $(this).addClass('active');
        },
        changeSpecs: function() {
            var value = $(this).val();
            $(this).parent('.range-unit').find('.content-value').html(value);
        },
        loadSpecs: function() {
            var height = $('#height').val(),
                weight = $('#weight').val();
            $('.range-unit .height-content .content-value').html(height);
            $('.range-unit .weight-content .content-value').html(weight);
        },
        _submit: function(e) {
            e.preventDefault();
            var formData = new FormData($('#size-suggestion-form')[0]);
            $.ajax({
                type: 'POST',
                url: urlBuilder.build('sizeguide/findsize/index'),
                dataType: 'json',
                showLoader: true,
                data: formData,
                contentType: false,
                processData: false,
                context: this,
                success: function(response) {
                    $('#size-suggestion-result').html(response.html);
                    $(this.sizeGuidePopup).modal("closeModal");
                    var options = {
                            type: 'popup',
                            responsive: false,
                            innerScroll: false,
                            buttons: [],
                            modalClass: 'modal-size-guide modal-size-guide-result'
                        },
                        modalPopup = $(this.sizeSuggestionResult);
                    modal(options, modalPopup);
                    modalPopup.modal('openModal');
                }
            });
        },
        _back: function() {
            $(this.sizeSuggestionResult).modal("closeModal");
            this.showSizeGuidePopup();
        },
        checkbox: function() {
            $('[name=wear]').prop("checked", false);
            $(this).prop("checked", true);
        },
        chooseSize: function() {
            var size = $(this).attr('data-size');
            $('#product_addtocart_form [data-option-label=' + size + ']').trigger('click');
            $('#size-suggestion-result').modal("closeModal");
        }
    });
    return $.magenest.sizeGuide;
});