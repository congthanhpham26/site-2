define(['jquery', 'mage/url', 'Magento_Ui/js/modal/modal', ], function($, url, modal) {
    'use strict';
    return function(config, element) {
        $(element).on('submit', function(e) {
            e.preventDefault();
            if ($(this).valid()) {
                $("body").trigger('processStart');
                var productId = this.dataset.productid,
                    $formReview = $('#' + this.id),
                    formData = new FormData($($formReview)[0]),
                    message = "#review-result-message",
                    $formMessage = "#review-form-message";
                var options = {
                    type: 'popup',
                    responsive: false,
                    innerScroll: false,
                    title: '',
                    buttons: [],
                    modalClass: 'modal-review-message'
                };
                $.ajax({
                    url: url.build("rating_comment/reviews/post/id/" + productId),
                    method: "POST",
                    dataType: "json",
                    contentType: false,
                    processData: false,
                    data: formData,
                    context: this,
                    success: function(response) {
                        modal(options, $($formMessage));
                        $($formMessage).modal("openModal");
                        $($formReview)[0].reset();
                        $($formReview).modal("closeModal");
                        if (response.success) {
                            $(message).addClass('success-message');
                            $(message).removeClass('error-message');
                        } else {
                            $(message).removeClass('success-message');
                            $(message).addClass('error-message');
                        }
                        $(message).html(response.message);
                        $("body").trigger('processStop');
                    },
                    error: function(response) {
                        modal(options, $($formMessage));
                        $($formMessage).modal("openModal");
                        $($formReview)[0].reset();
                        $($formReview).modal("closeModal");
                        $(message).removeClass('success-message');
                        $(message).addClass('error-message');
                        $("body").trigger('processStop')
                    },
                    complete: function(response) {
                        $(message).removeClass('success-message');
                        $(message).addClass('error-message');
                        $("body").trigger('processStop')
                    }
                });
            }
        });
    };
});